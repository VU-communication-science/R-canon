{
  "hash": "f7bb2a5425141b2f1e657f76a505a342",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Controlling for confounders\"\nsubtitle: \"Using multiple regression to better test causal relationships\"\n---\n\n\n\n\n\n# Controlling for spurious correlations\n\nIn the section about [causality](../concepts/causality.qmd) we discussed the difference between correlation and causation, and what techniques we can use to distinguish between the two.\nOne of those techniques is to use **multivariate analysis** techniques, such as **multiple regression**.\nIn this tutorial we will show you how to use multiple regression to control for **confounding variables**, and how this helps us deal with **spurious correlations**.\nAs example data we'll be using a famous example of a spurious correlation: the number of storks and the birth rate of a country.\n\n## Do storks deliver babies?\n\nThere is a [famous example](http://www.brixtonhealth.com/storksBabies.pdf) of confounding, that points at the surprisingly high correlation between the number of storks and the number of newborn babies across European countries ($\\rho = 0.62$).\nBased on this empirical finding, could one actually argue that the might be some truth to the old folk tale that storks deliver babies?\nThe answer to this questions is obviously no, but it does raise an important issue: \nhow can we distinguish between correlation and causation?\nThe example of storks and babies is sufficiently ridiculous to make it clear that this is a spurious correlation, but how can we be sure in more realistic cases?\n\nOne of the techniques in our tool belt is to control for confounding variables in a multiple regression model.\nLet's see how this works in practice using the storks and babies data from the article.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sjPlot)\n\nstorks <- tibble(\n storks = c(100,300,1,5000,9,140,3300,2500,4,5000,5,30000,1500,5000,8000,150,25000),\n birth_rate = c(83,87,118,117,59,774,901,106,188,124,551,610,120,367,439,82,1576),\n area_km2 = c(29,84,31,111,43,544,357,132,42,93,301,312,92,237,505,41,779) \n)\n```\n:::\n\n\n\n\n\n## Correlation analysis\n\nThe data we have here is about the number of `storks`, the `birth_rate`, and the `area_km2` of the country.\nLet's first have a look at the correlations.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab_corr(storks)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"font-style:italic; font-weight:normal; border-top:double black; border-bottom:1px solid black; padding:0.2cm;\">&nbsp;</th>\n<th style=\"font-style:italic; font-weight:normal; border-top:double black; border-bottom:1px solid black; padding:0.2cm;\">storks</th>\n<th style=\"font-style:italic; font-weight:normal; border-top:double black; border-bottom:1px solid black; padding:0.2cm;\">birth_rate</th>\n<th style=\"font-style:italic; font-weight:normal; border-top:double black; border-bottom:1px solid black; padding:0.2cm;\">area_km2</th>\n</tr>\n<tr>\n<td style=\"font-style:italic;\">storks</td>\n<td style=\"padding:0.2cm; text-align:center;\">&nbsp;</td>\n<td style=\"padding:0.2cm; text-align:center;\">0.620<span style=\"vertical-align:super;font-size:0.8em;\">**</span></td>\n<td style=\"padding:0.2cm; text-align:center;\">0.579<span style=\"vertical-align:super;font-size:0.8em;\">*</span></td>\n</tr>\n<tr>\n<td style=\"font-style:italic;\">birth_rate</td>\n<td style=\"padding:0.2cm; text-align:center;\">0.620<span style=\"vertical-align:super;font-size:0.8em;\">**</span></td>\n<td style=\"padding:0.2cm; text-align:center;\">&nbsp;</td>\n<td style=\"padding:0.2cm; text-align:center;\">0.922<span style=\"vertical-align:super;font-size:0.8em;\">***</span></td>\n</tr>\n<tr>\n<td style=\"font-style:italic;\">area_km2</td>\n<td style=\"padding:0.2cm; text-align:center;\">0.579<span style=\"vertical-align:super;font-size:0.8em;\">*</span></td>\n<td style=\"padding:0.2cm; text-align:center;\">0.922<span style=\"vertical-align:super;font-size:0.8em;\">***</span></td>\n<td style=\"padding:0.2cm; text-align:center;\">&nbsp;</td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"border-bottom:double black; border-top:1px solid black; font-style:italic; font-size:0.9em; text-align:right;\">Computed correlation used pearson-method with listwise-deletion.</td>\n</tr>\n \n</table>\n`````\n:::\n:::\n\n\n\n\n\nAs reported in the article, the correlation between the number of storks and the birth rate is high at $r = 0.62$.\nBut we also see that the area of the country is correlated with both the number of storks and the birth rate ($r = 0.58$ and $r = 0.92$ respectively).\nThis is a good indication that the area of the country is likely a confounding variable.\n\n## Multiple regression analysis\n\nNow let's see what happens when we put the number of storks into a regression model.\nOur dependent variable is the `birth_rate`, our independent variable is the `storks`, and we'll control for the `area_km2`.\nThe variables are standardized first, so that you can see the relation to the correlation coefficients.\nWe'll run two models: without and with the control variable.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##  standardize all variables\nstorks_z <- storks |> scale() |> as_tibble()\n\nm1 <- lm(birth_rate ~ storks,            data = storks_z)\nm2 <- lm(birth_rate ~ storks + area_km2, data = storks_z)\ntab_model(m1, m2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">birth_rate</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">birth_rate</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7\">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">(Intercept)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.42&nbsp;&ndash;&nbsp;0.42</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.000</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.00</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.21&nbsp;&ndash;&nbsp;0.21</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7\">1.000</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">storks</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.62</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.19&nbsp;&ndash;&nbsp;1.05</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>0.008</strong></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.13</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.13&nbsp;&ndash;&nbsp;0.39</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7\">0.304</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">area km2</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.85</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.59&nbsp;&ndash;&nbsp;1.11</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7\"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">17</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">17</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> / R<sup>2</sup> adjusted</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.385 / 0.344</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.862 / 0.842</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\nIn the first model we see a positive effect of the number of storks on the birth rate ($\\beta = 0.62$).\nThe effect is significant (p < 0.01) and the standardized coefficient is the same as the correlation coefficient.\nSo here you see firsthand a spurious effect.\n\nIn the second model, where we control for the area of the country, the effect of the number of storks on the birth rate is no longer significant (p = 0.304).\nInstead, we see a very strong effect of the area of the country on the birth rate ($\\beta = 0.85$, p < 0.001).\nSo here you see the power of multiple regression in action: by controlling for `area_km2`, the spurious effect of `storks` on `birth_rate` disappears. \n\n# Why controlling for confounding is important\n\nIf we do not control for confounding variables, the coefficients in our regression model might be biased.\nSometimes the effect is overestimated, as we saw here with the effect of storks on the birth rate.\nBut the effect can also be suppressed, or even reversed!\n\nBeing able to control for confounding variables enables us to better explore possible [causal relationships](../concepts/causality.qmd) between variables.\nBased on the first model, we might have concluded that if the number of storks increases or decreases, the birth rate of the country will follow.\nImagine the policy implications of such a finding!\nIf a government would want to increase the birth rate, they would simply have to breed more storks.\n\nThe second model however shows that this relation between storks and birth rate is spurious.\nThis suggests that our stork breeding program would not have the desired effect.\nInstead, the model gives reason to believe that the birth rate is influenced by the size of the country, which is a much more plausible explanation.\nIf a government would want to increase the birth rate, they would have to increase the size of the country.\nAnd this is why we have too many wars, and too few storks.",
    "supporting": [
      "controlling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}